<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.6: http://docutils.sourceforge.net/" />
<title>alsaseq – ALSA sequencer bindings for Python</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5951 2009-05-18 18:03:10Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left{
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: left }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em ;
  background-color: #eeeeee }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="alsaseq-alsa-sequencer-bindings-for-python">
<h1 class="title">alsaseq – ALSA sequencer bindings for Python</h1>

<!-- project.rst -->
<!--  -->
<!-- Copyright (c) 2009 Patricio Paez <pp@pp.com.mx> -->
<!--  -->
<!-- This program is free software; you can redistribute it and/or modify -->
<!-- it under the terms of the GNU General Public License as published by -->
<!-- the Free Software Foundation; either version 2 of the License, or -->
<!-- (at your option) any later version. -->
<!--  -->
<!-- This program is distributed in the hope that it will be useful, -->
<!-- but WITHOUT ANY WARRANTY; without even the implied warranty of -->
<!-- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the -->
<!-- GNU General Public License for more details. -->
<!--  -->
<!-- You should have received a copy of the GNU General Public License -->
<!-- along with this program.  If not, see <http://www.gnu.org/licenses/> -->
<p><em>alsaseq</em> is a Python 3 and Python 2 module that allows to interact with ALSA
sequencer clients. It can create an ALSA client, connect to other
clients, send and receive ALSA events immediately or at a scheduled
time using a sequencer queue. It provides a subset of the ALSA
sequencer capabilities in a simplified model. It is implemented in
C language and licensed under the Gnu GPL license version 2 or
later.</p>
<p>The project is available at <a class="reference external" href="http://pp.com.mx/python/alsaseq">http://pp.com.mx/python/alsaseq</a></p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#requirements" id="id1">Requirements</a></li>
<li><a class="reference internal" href="#installation" id="id2">Installation</a></li>
<li><a class="reference internal" href="#interactive-use" id="id3">Interactive use</a></li>
<li><a class="reference internal" href="#examples" id="id4">Examples</a></li>
<li><a class="reference internal" href="#appendix" id="id5">Appendix</a></li>
</ul>
</div>
<div class="section" id="requirements">
<h1><a class="toc-backref" href="#id1">Requirements</a></h1>
<p>The Python and the ALSA development header files, as well as the GNU C compiler
are needed to compile the module. If you use Debian or a distribution derived
from Debian like Ubuntu, make sure that the <strong>python-dev</strong> (for Python 2),
<strong>python3-dev</strong> (for Python 3), <strong>libasound2-dev</strong> and <strong>gcc</strong> packages are
installed. If you use Mandriva, check that the <strong>libpython2.6-devel</strong> (for Python 2),
<strong>libpython3.1-devel</strong> (for Python 3),  <strong>libalsa2-devel</strong> and <strong>gcc</strong> packages
are installed.</p>
</div>
<div class="section" id="installation">
<h1><a class="toc-backref" href="#id2">Installation</a></h1>
<p>Download the latest alsaseq.tar.gz file into a directory:</p>
<pre class="literal-block">
$ wget http://pp.com.mx/python/alsaseq/alsaseq-&lt;version&gt;.tar.gz
</pre>
<p>Extract the contents:</p>
<pre class="literal-block">
$ tar xf alsaseq-&lt;version&gt;.tar.gz
</pre>
<p>Enter the folder alsaseq-&lt;version&gt; that was created:</p>
<pre class="literal-block">
$ cd alsaseq-&lt;version&gt;
</pre>
<p>To compile the module:</p>
<pre class="literal-block">
$ python setup.py build
</pre>
<p>To install the module, execute as root:</p>
<pre class="literal-block">
# python setup.py install
</pre>
<p>To test:</p>
<pre class="literal-block">
$ python -c 'import alsaseq, alsamidi'
</pre>
<p>For python 3, the last three commands should be:</p>
<pre class="literal-block">
$ python3 setup.py build

# python3 setup.py install

$ python3 -c 'import alsaseq, alsamidi'
</pre>
<p>It is possible to build and install the module for both Python 2 and 3, both
versions can coexist in the same system.</p>
</div>
<div class="section" id="interactive-use">
<h1><a class="toc-backref" href="#id3">Interactive use</a></h1>
<p>Create an ALSA sequencer client with one input port and one output
port, no queue:</p>
<pre class="literal-block">
&gt;&gt;&gt; import alsaseq
&gt;&gt;&gt; alsaseq.client( 'Simple', 1, 1, False )
</pre>
<p>Port 0 is input, port 1 is output. Connect ALSA client 129 (could
be a musical keyboard or Virtual Keyboard) to the input port, and
connect output port to ALSA client 130 (a MIDI to sound converter
like Timidity):</p>
<pre class="literal-block">
&gt;&gt;&gt; alsaseq.connectfrom( 0, 129, 0 )
&gt;&gt;&gt; alsaseq.connectto( 1, 130, 0 )
</pre>
<p>Check if there are events in the input port due to notes played in
the MIDI keyboard:</p>
<pre class="literal-block">
&gt;&gt;&gt; alsaseq.inputpending()
2
</pre>
<p>Read and display an ALSA event:</p>
<pre class="literal-block">
&gt;&gt;&gt; alsaseq.input()
(6, 1, 0, 253, (0, 0), (0, 0), (0, 0), (0, 60, 127, 0, 0))
</pre>
<p>ALSA events are tuples with 8 elements: (type, flags, tag, queue,
time stamp, source, destination, data). In a client without queue,
received events have no time information and are asigned dummy
queue number 253.</p>
<p>Save a received event to send it for immediate processing:</p>
<pre class="literal-block">
&gt;&gt;&gt; event = alsaseq.input()
&gt;&gt;&gt; alsaseq.output( event )
</pre>
<p>In a client with createqueue = True, you first start the queue in
order to schedule events for execution at a certain time:</p>
<p>In order to time stamp received events and to schedule output
events for execution at a certain time, specify the client with
createqueue = True, and start the queue:</p>
<pre class="literal-block">
&gt;&gt;&gt; alsaseq.client( 'Simple', 1, 1, True )
&gt;&gt;&gt; alsaseq.start()
&gt;&gt;&gt; alsaseq.output( (6, 1, 0, 1, (5, 0), (0, 0), (0, 0), (0, 60, 127, 0, 100)) )
</pre>
<p>The above output() schedules a C note at 5 seconds after the
start() command, for a duration of 100ms.</p>
<pre class="literal-block">
&gt;&gt;&gt; alsaseq.input()
(6, 1, 0, 1, ( 12, 125433), (0, 0), (0, 0), (0, 62, 120, 0, 100)))
</pre>
<p>The above ALSA event was received in the input port 12 seconds and
123,433 millionths after the start() command. You can view the
status ( running, stopped ) of que queue, the current time, and the
number of events queued for output. You may also stop the queue:</p>
<pre class="literal-block">
&gt;&gt;&gt; alsaseq.status()
( 1, ( 20, 546234 ), 0 )
&gt;&gt;&gt; alsaseq.stop()
</pre>
<p>The status() shows the queue as running at 20 seconds, 546,234
millionths, with no events scheduled for output.</p>
<p>ALSA events for common MIDI events can be created using helper
functions in alsamidi module:</p>
<pre class="literal-block">
&gt;&gt;&gt; alsamidi.noteevent( 1, 60, 120, 5000, 10 )
(5, 1, 0, 0, (5, 0), (0, 0), (0, 0), (1, 60, 120, 0, 10))
</pre>
<p>&nbsp;See help( alsamidi ) or pydoc( alsamidi ) for more information.</p>
</div>
<div class="section" id="examples">
<h1><a class="toc-backref" href="#id4">Examples</a></h1>
<p>In these example scripts it is assumed that client 129 is a MIDI
keyboard, clients 130 and 131 are MIDI sound generation modules.</p>
<div class="section" id="midi-through">
<h2>MIDI through</h2>
<pre class="literal-block">
import alsaseq
alsaseq.client( 'MIDI through', 1, 1, False )
alsaseq.connectfrom( 1, 129, 0 )
alsaseq.connectto( 0, 130, 0 )

while 1:
    if alsaseq.inputpending():
  &nbsp; ev = alsaseq.input()
  &nbsp; alsaseq.output( ev )
</pre>
<p>Press control + c to interrupt the loop.</p>
</div>
<div class="section" id="midi-router">
<h2>MIDI router</h2>
<pre class="literal-block">
import alsaseq
alsaseq.client( 'Router', 1, 2, False )
alsaseq.connectfrom( 1, 129, 0 )
alsaseq.connectto( 0, 130, 0 )
alsaseq.connectto( 0, 131, 0 )

while 1:
&nbsp;   if alsaseq.inputpending():
  &nbsp;    ev = list( alsaseq.input() )
     &nbsp; if ev[7][1] &gt; 60: # if note is above C split limit,
    &nbsp;      ev[5][0] = 2, # use second output port
     &nbsp; alsaseq.output( ev )
</pre>
<p>Press control + c to interrupt the loop.</p>
</div>
<div class="section" id="recorder">
<h2>Recorder</h2>
<pre class="literal-block">
import alsaseq, pickle
alsaseq.client( 'Recorder', 1, 0, True )
alsaseq.connectfrom( 1, 129, 0 )
alsaseq.start()
events = []

while 1:
&nbsp; if alsaseq.inputpending():
&nbsp; event = alsaseq.input()
&nbsp; if event[7][1] == 56: # if note is central G#
&nbsp;   break # quit recording
&nbsp; events.append( ev )

pickle.dump( events, open( 'events.seq', 'w' ) )
</pre>
</div>
<div class="section" id="player">
<h2>Player</h2>
<pre class="literal-block">
import alsaseq, pickle
events = pickle.load( open( ruta ) )
alsaseq.client( 'Player', 0, 1, True )
alsaseq.connectto( 0, 130, 0 )
alsaseq.start()

for event in events:
&nbsp; alsaseq.output( event )
</pre>
</div>
</div>
<div class="section" id="appendix">
<h1><a class="toc-backref" href="#id5">Appendix</a></h1>
<div class="section" id="manually-build-and-install">
<h2>Manually build and install</h2>
<p>This is just provided for informational purposes, in case the setup.py
does not work or just for fun.  The following commands assume that Python 2.6
or Python 3.1 are installed; adjust the paths if a different version is used.</p>
<p>To compile the module:</p>
<pre class="literal-block">
$ gcc -shared -Wall -I /usr/include/python2.6 -lasound -o alsaseq.so alsaseq.c
</pre>
<p>To install the module, copy the <strong>alsaseq.so</strong>, <strong>alsamidi.py</strong> and
<strong>midiinstruments.py</strong> files to
/usr/local/lib/python2.6 as root:</p>
<pre class="literal-block">
# install alsaseq.so alsamidi.py midiinstruments.py /usr/local/lib/python2.6/site-packages
</pre>
<p>For Python 3:</p>
<pre class="literal-block">
$ gcc -shared -I /usr/include/python3.1 -lasound -o alsaseq.so alsaseq.c

# install alsaseq.so alsamidi.py midiinstruments.py /usr/local/lib/python3.1/site-packages
</pre>
</div>
<div class="section" id="recommendations-about-midi-software-and-hardware">
<h2>Recommendations about MIDI software and hardware</h2>
<p>To hear notes played by the ALSA sequencer while being controlled
by alsaseq,
you will need a software sound renderer like Timidity, which you
can install from the <strong>timidity</strong> package in most distributions.
To input notes to the ALSA sequencer and read them with alsaseq
you may use a virtual keyboard like <strong>vkeybd</strong>, available from
a package with the same name.</p>
<p>If you have a MIDI keyboard or piano and/or a hardware MIDI sound
module, you may connect them to your PC using a <em>USB-to-MIDI interface</em>.
I use the <strong>MIDI 1x1</strong>  from <em>E-EMU</em> and the <strong>MIDIsport UNO</strong>
from <em>M-AUDIO</em> which work fine.</p>
<p>Document generated on 2011-01-13 at 22:42 CST.</p>
</div>
</div>
</div>
</body>
</html>
